// Test cases for array type schemas

// ============================================================================
// Valid Cases
// ============================================================================

// ============================================================================
// Test Case 1: Basic array types
// ============================================================================

@ cases.basic
input_eure = ```eure
a = [1, 2, 3]
b = [1, 2, 3]
c = [[1, 2], [3, 4]]
d = [{ a => 1, b => 2 }, { a => 3, b => 4 }]
e = [{ array => [1, 2, 3] }, { array => [4, 5, 6] }]
```

schema = ```eure
a = [`integer`]
b = [`integer`]
c = [[`integer`]]
d = [{ a => `integer`, b => `integer` }]
e = [{ array => [`integer`] }]
```

output_json_schema = ```json
{
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "a": {
      "type": "array",
      "items": { "type": "integer" }
    },
    "b": {
      "type": "array",
      "items": { "type": "integer" }
    },
    "c": {
      "type": "array",
      "items": {
        "type": "array",
        "items": { "type": "integer" }
      }
    },
    "d": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "a": { "type": "integer" },
          "b": { "type": "integer" }
        },
        "required": ["a", "b"]
      }
    },
    "e": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "array": {
            "type": "array",
            "items": { "type": "integer" }
          }
        },
        "required": ["array"]
      }
    }
  },
  "required": ["a", "b", "c", "d", "e"]
}
```

// ============================================================================
// Test Case 2: Array with section syntax
// ============================================================================

@ cases.section-syntax
input_eure = ```eure
tags[] = "rust"
tags[] = "eure"
tags[] = "schema"
```

schema = ```eure
tags = [`text`]
```

// ============================================================================
// Error Cases
// ============================================================================

// ============================================================================
// Test Case 3: Array item type mismatch
// ============================================================================

@ cases.item-type-mismatch
input_eure = ```eure
numbers[] = 1
numbers[] = "two"
numbers[] = 3
```

schema = ```eure
numbers = [`integer`]
```

schema_errors = [
  ```
error: Type mismatch: expected integer, got text at path numbers[1]
 --> input.eure:2:13
  |
2 | numbers[] = "two"
  |             ^^^^^ Type mismatch: expected integer, got text at path numbers[1]
  |
note: constraint defined here
 --> schema.eure:1:12
  |
1 | numbers = [`integer`]
  |            --------- constraint defined here
```
]

// ============================================================================
// Test Case 4: Array missing contains - valid case
// ============================================================================

@ cases.contains-valid
input_eure = ```eure
items = [1, 2, 42, 3]
```

schema = ```eure
items {
  $variant = "array"
  item = `integer`
  contains = 42
}
```

// ============================================================================
// Test Case 5: Array missing contains - error case
// ============================================================================

@ cases.contains-missing
input_eure = ```eure
items = [1, 2, 3]
```

schema = ```eure
items {
  $variant = "array"
  item = `integer`
  contains = 42
}
```

schema_errors[] = ```text
error: Array must contain required element at path items
 --> input.eure:1:9
  |
1 | items = [1, 2, 3]
  |         ^^^^^^^^^ Array must contain required element at path items
  |
note: constraint defined here
 --> schema.eure:1:1
  |
1 | / items {
2 | |   $variant = "array"
3 | |   item = `integer`
4 | |   contains = 42
5 | | }
  | |_- constraint defined here
```
