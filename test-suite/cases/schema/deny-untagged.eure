// Test cases for $deny-untagged union variant constraint
// When a variant has $deny-untagged = true, values must have explicit $variant tag
schema_roundtrip_mode = `schema`

// ============================================================================
// Valid Cases
// ============================================================================

// ============================================================================
// Test Case 1: Explicit $variant tag provided for deny-untagged variant
// ============================================================================

@ cases.with-explicit-tag
schema_roundtrip_mode = `schema`
input_eure = ```eure
value {
  = "active"
  $variant = "literal"
}
```

schema = ```eure
value {
  $variant = "union"
  variants.literal = "active"
  variants.literal.$deny-untagged = true
  variants.text = `text`
}
```

// No errors - explicit $variant tag provided

// ============================================================================
// Test Case 2: Non-deny-untagged variant matched without tag
// ============================================================================

@ cases.non-deny-untagged-variant
schema_roundtrip_mode = `schema`
input_eure = ```eure
value = "other"
```

schema = ```eure
value {
  $variant = "union"
  variants.literal = "active"
  variants.literal.$deny-untagged = true
  variants.text = `text`
}
```

// No errors - "other" doesn't match literal, falls through to text variant

// ============================================================================
// Error Cases
// ============================================================================

// ============================================================================
// Test Case 3: Deny-untagged variant matched without explicit tag
// ============================================================================

@ cases.without-explicit-tag
schema_roundtrip_mode = `schema`
input_eure = ```eure
value = "active"
```

schema = ```eure
value {
  $variant = "union"
  variants.literal = "active"
  variants.literal.$deny-untagged = true
  variants.text = `text`
}
```

schema_errors[] = ```text
error: Variant 'literal' requires explicit $variant tag at path value
 --> input.eure:1:9
  |
1 | value = "active"
  |         ^^^^^^^^ Variant 'literal' requires explicit $variant tag at path value
  |
note: constraint defined here
 --> schema.eure:3:22
  |
3 |   variants.literal = "active"
  |                      -------- constraint defined here
```
